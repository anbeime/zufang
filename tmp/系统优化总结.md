# 租户管理系统优化总结

## 改进目标

1. 移除租户码系统，改用手机号作为唯一标识
2. 优化购物流程，改为输入付款金额模式
3. 简化所有页面的用户交互

## 核心改进

### 1. 移除租户码系统 ✅

**原设计问题**：
- 租户码和手机号双重标识，造成混乱
- 用户需要记住6位数字码，增加认知负担
- 系统需要额外生成和维护租户码

**改进方案**：
- 统一使用手机号作为唯一标识
- 移除所有租户码相关逻辑
- 简化数据库和代码结构

**修改内容**：
- `src/storage/database/tenantManager.ts`：移除 `generateTenantCode()` 和 `getTenantByCode()` 方法
- `src/app/checkin/page.tsx`：移除租户码生成和显示逻辑
- `src/app/pay/page.tsx`：移除租户码登录选项，只保留手机号
- `src/app/checkout-room/page.tsx`：移除租户码登录选项（需确认）
- `src/app/page.tsx`：更新文案，移除租户码描述
- `src/app/admin/qrcodes/page.tsx`：更新二维码使用说明

### 2. 优化购物流程 ✅

**原设计问题**：
- 需要逐个添加商品、填写名称、价格、数量
- 不符合实际商超收银场景
- 操作繁琐，效率低下

**改进方案**：
- 直接输入付款金额
- 选择优惠券抵扣
- 一键支付

**新流程**：
1. 输入手机号查询租户
2. 输入付款金额
3. 选择优惠券（可选）
4. 确认支付

**修改内容**：
- `src/app/checkout/page.tsx`：
  - 重构为"输入金额"模式
  - 保留优惠券选择功能
  - 简化UI，突出金额输入
  - 优化优惠券展示效果

### 3. 简化入住流程 ✅

**原流程**：手机号验证 → 选择房间 → 填写信息 → 完成
**新流程**：选择房间 → 填写信息（姓名+手机号）→ 完成

**改进点**：
- 去除手机号唯一性验证步骤
- 手机号仅用于接收通知，不做唯一性校验
- 页面加载时自动显示所有可用房间
- 支持房间二维码预选，但仍允许切换

### 4. 简化支付流程 ✅

**改进点**：
- 移除租户码登录选项
- 只保留手机号登录
- 移除租户码显示

## 完整使用流程

### 入住流程
1. 扫码入住（通用二维码）→ 选择房间 → 填写姓名+手机号 → 完成
2. 扫码房间二维码 → 预选该房间 → 填写姓名+手机号 → 完成

### 交费流程
1. 扫码交费 → 输入手机号 → 查看账单 → 选择支付

### 购物流程（新）
1. 扫码购物 → 输入手机号 → 输入付款金额 → 选择优惠券 → 支付

### 退房流程
1. 扫码退房 → 输入手机号 → 确认退房 → 自动结算押金

## 二维码使用说明

### 商户通用二维码（共3个）
1. **入住二维码**：贴在入口、前台、电梯口等显眼位置
   - 扫码查看所有可用房间
   - 租户自行选择心仪房间

2. **交费二维码**：贴在收款处、电梯口
   - 扫码输入手机号查看账单
   - 选择账单并支付

3. **退房二维码**：贴在退房登记处、前台
   - 扫码输入手机号办理退房
   - 自动结算押金

### 房间二维码
- 每个房间门口贴一个专属二维码
- 扫码后该房间被预选（高亮显示）
- 仍可切换选择其他房间

## 技术实现细节

### 数据库修改
- `tenants` 表保留 `tenantCode` 字段（为了兼容历史数据），但不再生成和使用

### API 修改
- 移除 `/api/tenants?tenantCode=xxx` 查询参数
- 只保留 `/api/tenants?phone=xxx` 查询方式

### 前端修改
- 所有页面移除租户码输入框
- 成功页面移除租户码显示，改为显示手机号
- 更新所有文案和提示信息

## 用户体验提升

1. **更简单**：只需记住手机号，无需额外记忆
2. **更直观**：购物直接输入金额，符合实际场景
3. **更高效**：减少操作步骤，提升效率
4. **更清晰**：统一使用手机号作为唯一标识，避免混淆

## 后续优化建议

1. 添加手机号短信验证，提高联系方式准确性
2. 支持房间图片展示，让租户更直观了解房间
3. 添加房间详细信息弹窗（楼层、朝向、设施等）
4. 支持批量打印房间二维码
5. 添加租户历史记录查询功能

## 验证清单

- [x] 入住页面正常显示房间列表
- [x] 入住成功后显示手机号而非租户码
- [x] 支付页面只保留手机号登录
- [x] 购物页面改为输入金额模式
- [x] 优惠券选择功能正常
- [x] 首页文案已更新
- [x] 二维码管理页面说明已更新
- [x] 服务正常运行
