# 入住流程改进说明

## 问题描述

原入住流程存在以下问题：
1. 需要先输入手机号才能查看房间
2. 手机号重复注册会被拒绝
3. 无法实现真正的"扫码即住"

## 改进方案

### 1. 简化入住流程

**原流程**：手机号验证 → 选择房间 → 填写信息 → 完成
**新流程**：选择房间 → 填写信息（含手机号）→ 完成

### 2. 关键改进点

#### ✅ 去除手机号验证步骤
- 移除了强制手机号唯一性验证
- 手机号仅用于接收通知，不做唯一性校验
- 允许多个租户使用相同手机号（如家庭成员共用）

#### ✅ 页面加载时自动获取房间列表
- 访问入住页面立即显示所有可用房间
- 租户可以像"选座位"一样自由选择房间
- 按房间类型分组展示（单房、家庭房、豪华房、套房）

#### ✅ 支持房间二维码预选
- 扫描房间二维码（`/checkin?roomId=xxx`）自动预选该房间
- 但仍显示其他房间，允许租户重新选择
- 如果房间已被占用，友好提示但不阻止操作

### 3. 二维码使用场景

#### 商户通用二维码
- **入住二维码**：贴在入口、前台等显眼位置
  - 扫码后查看所有可用房间
  - 租户自行选择心仪房间
  - 填写姓名、手机号、押金即可完成入住

- **交费二维码**：贴在收款处、电梯口
  - 扫码后输入租户码或手机号登录
  - 查看账单并支付

- **退房二维码**：贴在退房登记处、前台
  - 扫码后输入租户码或手机号登录
  - 自动结算押金并退款

#### 房间二维码
- 每个房间门口贴一个专属二维码
- 扫码后该房间被预选（高亮显示）
- 但仍可切换选择其他房间
- 适合租户已经看中特定房间的情况

### 4. 用户体验提升

1. **更直观**：看到房间列表后才能决定是否入住
2. **更灵活**：可以随时更换选择房间
3. **更简单**：只需3步：选房 → 填信息 → 完成
4. **更友好**：手机号仅作联系方式，不再作为唯一标识

### 5. 商户维护成本

- **零人工干预**：租户全程自助完成
- **二维码管理**：只需打印一次二维码，长期使用
- **房间状态自动更新**：入住成功后房间状态自动变为"已租用"

## 技术实现

### 修改的文件
1. `src/app/checkin/page.tsx` - 入住页面
2. `src/app/page.tsx` - 首页文案
3. `src/app/admin/qrcodes/page.tsx` - 二维码管理页面说明

### 核心代码变更

```typescript
// 原代码：需要先输入手机号
const [step, setStep] = useState<'phone' | 'select' | 'form' | 'success'>('phone');
const handleCheckPhone = async () => {
  // 检查是否已注册
  const res = await fetch(`/api/tenants?phone=${phone}`);
  if (data.success && data.data.length > 0) {
    alert('该手机号已注册，请使用其他号码'); // ❌ 阻碍入住
    return;
  }
  ...
}

// 新代码：直接显示房间列表
const [step, setStep] = useState<'select' | 'form' | 'success'>('select');

// 页面加载时自动获取可用房间
useEffect(() => {
  loadAvailableRooms();
  const roomId = searchParams.get('roomId');
  if (roomId) loadRoomById(roomId);
}, [searchParams]);
```

## 验证结果

✅ 页面正常加载并显示可用房间列表
✅ 房间按类型分组展示
✅ 支持点击选择房间并高亮显示
✅ 表单包含姓名、手机号、押金三个字段
✅ 手机号不再做唯一性验证
✅ 入住成功后显示租户码

## 下一步建议

1. 添加房间图片展示，让租户更直观了解房间
2. 支持按价格、面积等条件筛选房间
3. 添加房间详细信息弹窗（楼层、朝向、设施等）
4. 实现手机号短信验证，提高联系方式准确性
